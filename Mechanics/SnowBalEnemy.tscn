[gd_scene load_steps=3 format=3 uid="uid://bxw7kpfudeajs"]

[sub_resource type="GDScript" id="GDScript_745ot"]
script/source = "extends Moving_Enemy

@onready var timer: Timer = $Timer
const SNOWBALL_SCENE: PackedScene = preload(\"res://Mechanics/snowball.tscn\")
var homing: bool = true
var throw_speed: float = 300
var random_throw_angle_range: float = 45
var thrown: bool = false
var can_throw: bool = true

func _physics_process(_delta: float) -> void:
	if can_throw and not thrown:
		if homing:
			var player = get_player()
			if player:
				lock_in_player(player)
		else:
			throw_randomly()
		
func lock_in_player(player):
	if player is CharacterBody2D:
		var to_player_direction = (player.global_position - global_position).normalized()
		var velocity = to_player_direction * throw_speed
		fire_snowball(velocity)
	
func throw_randomly():
	var angle_degrees = randf() * random_throw_angle_range - random_throw_angle_range / 2
	var angle_radians = deg_to_rad(angle_degrees)
	var velocity = Vector2(throw_speed, 0).rotated(angle_radians)
	fire_snowball(velocity)
	
func get_player():
	var all_nodes = get_tree().get_nodes_in_group(\"Player\")
	if all_nodes.size() > 0:
		return all_nodes[0]
	return null

func fire_snowball(init_velocity: Vector2):
	var instance = SNOWBALL_SCENE.instantiate()
	add_child(instance)
	instance.global_position = global_position
	instance.scale /= 2
	instance.velocity = init_velocity
	thrown = true
	
func _on_timer_timeout() -> void:
	if can_throw:
		can_throw = false
		return
	can_throw = true
	thrown = false
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_au7ya"]

[node name="SnowBalEnemy" type="RigidBody2D"]
gravity_scale = 5.0
script = SubResource("GDScript_745ot")

[node name="Sprite2d" type="Sprite2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_au7ya")

[node name="Timer" type="Timer" parent="."]
one_shot = true

[connection signal="timeout" from="Timer" to="." method="_on_timer_timeout"]
